/*!
 * Innovare.Map JavaScript Library v0.1
 * https://github.com/innova-re/map
 *
 * Copyright 2014, Antonio Pierro
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Date: Mon June 30
 */
 (function(e,t){"use strict";var n=function(e){this.$selectedMap=e.find(".map-destination :selected");this.latLng=this.getLatLng(this.$selectedMap.attr("map-latLng"));this.latLngMarker=this.getLatLng(this.$selectedMap.attr("map-marker"));this.zoom=19;this.$mapForm=e;this.map=this.getMap();this.dataMarker=this.$selectedMap.attr("map-marker");this.dataMarkerImage=this.$selectedMap.attr("map-marker-image")};n.prototype={constructor:n,init:function(){this.setMarker(this.latLng);this.setMarker(this.latLngMarker,this.dataMarkerImage);this.setLine();this.setDirectionsOnMap();this.$mapForm.show();this.$mapForm.find(".map-setRoute").click(e.proxy(this.setRoute,this));google.maps.event.addListener(this.map,"zoom_changed",e.proxy(this.toggleMarker,this));this.setInfoWindow(this.$selectedMap.attr("map-help"))},getLatLng:function(e){var e=e.split(",");return new google.maps.LatLng(t(e[0],10),t(e[1],10))},getMap:function(){return new google.maps.Map(e(".map-canvas")[0],{zoom:this.zoom,center:this.latLng,mapTypeId:google.maps.MapTypeId.SATELLITE})},getCoordinates:function(e){var t=[];var e=e.split(",");for(var n=0;n<e.length;n++){t.push(new google.maps.LatLng(e[n],e[n+1]));n=n+1}return t},getPlan:function(){return e("<img>").attr("class","poly-info").attr("src",this.$selectedMap.attr("map-plan"))[0]},getRequest:function(){return{destination:this.latLng,origin:this.$mapForm.find(".map-departure").val(),travelMode:google.maps.TravelMode[this.$mapForm.find(".map-mode").val()]}},setDirectionsOnMap:function(){this.directionsService=new google.maps.DirectionsService;this.directionsRenderer=new google.maps.DirectionsRenderer;this.directionsRenderer.setMap(this.map)},setDirections:function(e,t){if(t===google.maps.DirectionsStatus.OK){this.directionsRenderer.setDirections(e)}},setLine:function(){var e={path:google.maps.SymbolPath.CIRCLE,strokeOpacity:1,scale:4};new google.maps.Polyline({path:this.getCoordinates(this.$selectedMap.attr("map-walking-path")),strokeOpacity:0,strokeColor:"#0066FF",icons:[{icon:e,offset:"0",repeat:"20px"}],map:this.map})},setMarker:function(t,n){this.marker=new google.maps.Marker({position:t,map:this.map,animation:google.maps.Animation.DROP,icon:n,draggable:true});google.maps.event.addListener(this.marker,"click",e.proxy(this.setInfoWindow,this,this.getPlan()))},setInfoWindow:function(t){if(typeof this.infoWindow!=="undefined"){this.infoWindow.close()}this.infoWindow=new google.maps.InfoWindow({content:e("<div>").attr("class","info-window").html(t)[0]});this.infoWindow.open(this.map,this.marker)},setRoute:function(){this.map.setMapTypeId(google.maps.MapTypeId.ROADMAP);this.directionsService.route(this.getRequest(),e.proxy(this.setDirections,this))},toggleMarker:function(){if(this.map.zoom<18){this.marker.setMap(null);this.map.setMapTypeId(google.maps.MapTypeId.ROADMAP)}else{this.marker.setMap(this.map);this.map.setMapTypeId(google.maps.MapTypeId.SATELLITE)}}};var r=function(e){var t=new n(e);t.init()};e(function(){var t=e(".map-form");r(t);t.find(".map-destination").change(function(){r(t)})})})(jQuery,window.parseFloat)